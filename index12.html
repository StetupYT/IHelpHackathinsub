

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Screenertron 9000</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f4f7fa;
      padding: 2rem;
      margin: 0;
    }
    .container {
      max-width: 620px;
      margin: auto;
      background: #ffffff;
      padding: 0;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      overflow: hidden;
      border: 1px solid #e0e0e0;
    }
    .header {
      background: linear-gradient(to right, #eaf3ff, #f1f7ff);
      color: #1c3d7a;
      padding: 1.2rem;
      text-align: center;
      font-size: 1.75rem;
      font-weight: 600;
      border-bottom: 1px solid #c9daf6;
    }
    .content {
      padding: 1.8rem;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-bottom: 1rem;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      background-color: #fdfdfd;
      resize: vertical;
    }
    .file-input-label, .action-button {
      display: inline-block;
      padding: 0.4rem 0.7rem;
      background-color: #f1f3f5;
      color: #2c3e50;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.75rem;
      margin-right: 0.4rem;
      margin-bottom: 1rem;
      transition: background-color 0.2s;
      user-select: none;
    }
    .file-input-label:hover, .action-button:hover {
      background-color: #e1e7ed;
    }
    .check-button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 6px;
      margin-top: 0.5rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    .check-button:hover {
      background-color: #3c7dc1;
    }
    input[type="file"] {
      display: none;
    }
    #dropzone {
      border: 2px dashed #bbb;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      color: #666;
      margin-bottom: 1rem;
      transition: border-color 0.3s, background-color 0.3s;
      cursor: pointer;
      user-select: none;
    }
    #dropzone.dragover {
      border-color: #4a90e2;
      background-color: #eaf3ff;
      color: #1c3d7a;
    }
    #imagePreview {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: none;
    }
    /* Result dialog */
    #resultDialog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: white;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      max-width: 400px;
      width: 90%;
      padding: 1.5rem;
      color: white;
      font-size: 1rem;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
    }
    #resultDialog.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    #resultDialog .header {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    #resultDialog .header .icon {
      font-size: 1.6rem;
    }
    #resultDialog ul {
      margin-top: 0.5rem;
      padding-left: 1.3rem;
      color: #f0f0f0;
    }
    #resultDialog button.close-btn {
      margin-top: 1rem;
      background: rgba(255 255 255 / 0.3);
      border: none;
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      transition: background-color 0.2s;
    }
    #resultDialog button.close-btn:hover {
      background: rgba(255 255 255 / 0.5);
    }
    .loading {
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">Screenertron 9000</div>
    <div class="content">
      <p>Upload or drag & drop a screenshot of an SMS, or paste a message below to check if it's a scam.</p>

      <div id="dropzone">Drag & drop image here or click to select</div>
      <input type="file" id="imageInput" accept="image/*" />

      <img id="imagePreview" alt="Image preview" />

      <button class="file-input-label" id="extractBtn" disabled>Extract Text</button>

      <textarea id="messageInput" placeholder="Or paste message here..."></textarea>
      <button class="check-button" id="checkBtn">Check Message</button>

      <div id="loadingText" class="loading" style="display:none;">Processing...</div>
    </div>
  </div>

  <div id="resultDialog" role="dialog" aria-modal="true" aria-labelledby="resultTitle" aria-describedby="resultDesc" tabindex="-1">
    <div class="header">
      <span id="resultIcon" class="icon">‚ö†Ô∏è</span>
      <span id="resultTitle"></span>
    </div>
    <div id="resultDesc"></div>
    <button class="close-btn" id="closeDialogBtn">Close</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <script>
    const imageInput = document.getElementById('imageInput');
    const dropzone = document.getElementById('dropzone');
    const imagePreview = document.getElementById('imagePreview');
    const extractBtn = document.getElementById('extractBtn');
    const messageInput = document.getElementById('messageInput');
    const checkBtn = document.getElementById('checkBtn');
    const loadingText = document.getElementById('loadingText');
    const resultDialog = document.getElementById('resultDialog');
    const resultIcon = document.getElementById('resultIcon');
    const resultTitle = document.getElementById('resultTitle');
    const resultDesc = document.getElementById('resultDesc');
    const closeDialogBtn = document.getElementById('closeDialogBtn');

    // Helper to show dialog
    function showResultDialog(isScam, scamType, redFlags) {
      resultDialog.classList.add('show');
      if (isScam) {
        resultDialog.style.backgroundColor = '#c0392b'; // red
        resultIcon.textContent = 'üö®';
        resultTitle.textContent = `Scam detected: ${scamType}`;
      } else {
        resultDialog.style.backgroundColor = '#27ae60'; // green
        resultIcon.textContent = '‚úÖ';
        resultTitle.textContent = 'Message appears safe';
      }

      if (isScam && redFlags.length) {
        const flagsHtml = redFlags.map(flag => `<li>${flag}</li>`).join('');
        resultDesc.innerHTML = `<strong>Red Flags:</strong><ul>${flagsHtml}</ul>`;
      } else {
        resultDesc.innerHTML = '';
      }
      resultDialog.focus();
    }

    closeDialogBtn.addEventListener('click', () => {
      resultDialog.classList.remove('show');
    });

    // Drag & drop events
    dropzone.addEventListener('click', () => imageInput.click());

    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });

    dropzone.addEventListener('dragleave', e => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
    });

    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('dragover');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        imageInput.files = files; // Set the dropped file to file input
        handleImage(files[0]);
      }
    });

    imageInput.addEventListener('change', () => {
      if (imageInput.files.length > 0) {
        handleImage(imageInput.files[0]);
      }
    });

    function handleImage(file) {
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file.');
        imageInput.value = '';
        imagePreview.style.display = 'none';
        extractBtn.disabled = true;
        return;
      }
      const reader = new FileReader();
      reader.onload = e => {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        extractBtn.disabled = false;
      };
      reader.readAsDataURL(file);
      messageInput.value = '';
    }

    extractBtn.addEventListener('click', async () => {
      if (!imageInput.files.length) {
        alert('Please select an image first.');
        return;
      }
      loadingText.style.display = 'block';
      extractBtn.disabled = true;
      checkBtn.disabled = true;
      messageInput.value = '';

      try {
        const { data: { text } } = await Tesseract.recognize(imageInput.files[0], 'eng', {
          logger: m => {
            // Optional: show progress, can implement if you want
          }
        });
        messageInput.value = text.trim();
      } catch (err) {
        alert('Error extracting text from image.');
        console.error(err);
      }

      loadingText.style.display = 'none';
      extractBtn.disabled = false;
      checkBtn.disabled = false;
    });

    checkBtn.addEventListener('click', async () => {
      const message = messageInput.value.trim();
      if (!message) {
        alert('Please enter or extract a message to check.');
        return;
      }

      loadingText.style.display = 'block';
      checkBtn.disabled = true;
      extractBtn.disabled = true;

      // Simulate lively loading with small delay
      await new Promise(r => setTimeout(r, 500));

      try {
        // Call your Flask backend API - update URL if needed
        const response = await fetch('http://localhost:5000/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ message })
        });
        const data = await response.json();

        if (response.ok) {
          // Show results dialog
          showResultDialog(data.is_scam, data.scam_type, data.red_flags || []);
        } else {
          alert(data.error || 'Failed to analyze message.');
        }
      } catch (err) {
        alert('Error connecting to analysis service.');
        console.error(err);
      }

      loadingText.style.display = 'none';
      checkBtn.disabled = false;
      extractBtn.disabled = false;
    });
  </script>
</body>
</html>