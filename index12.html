<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Screenertron 9000</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f7fa;
      padding: 2rem;
      margin: 0;
    }
    .container {
      max-width: 620px;
      margin: auto;
      background: #ffffff;
      padding: 1rem;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }
    .header {
      text-align: center;
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    #dropzone {
      border: 2px dashed #bbb;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-bottom: 1rem;
      padding: 0.75rem;
    }
    button {
      padding: 0.6rem 1rem;
      font-size: 1rem;
      margin: 0.5rem 0;
      cursor: pointer;
    }
    #result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">Screenertron 9000</div>

  <div id="dropzone">Drag & drop image here or click to select</div>
  <input type="file" id="image-input" accept="image/*" style="display:none;"/>
  <button id="analyze-btn">Analyze Image</button>

  <textarea id="messageInput" placeholder="Or paste message here..."></textarea>
  <button id="checkBtn">Check Text for Scam</button>

  <div id="result"></div>
</div>

<script>
  const dropzone = document.getElementById('dropzone');
  const imageInput = document.getElementById('image-input');
  const analyzeBtn = document.getElementById('analyze-btn');
  const checkBtn = document.getElementById('checkBtn');
  const messageInput = document.getElementById('messageInput');
  const resultDiv = document.getElementById('result');

  dropzone.addEventListener('click', () => imageInput.click());

  dropzone.addEventListener('dragover', e => {
    e.preventDefault();
    dropzone.style.borderColor = 'blue';
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.style.borderColor = '#bbb';
  });

  dropzone.addEventListener('drop', e => {
    e.preventDefault();
    dropzone.style.borderColor = '#bbb';
    if (e.dataTransfer.files.length) {
      imageInput.files = e.dataTransfer.files;
    }
  });

  analyzeBtn.addEventListener('click', () => {
    const file = imageInput.files[0];
    if (!file) return alert('Select an image first.');
    const reader = new FileReader();
    reader.onloadend = () => {
      fetch('/analyze', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({image: reader.result})
      })
      .then(res => res.json())
      .then(data => {
        displayResult(data);
      })
      .catch(err => {
        console.error(err);
        alert('Failed to connect to server.');
      });
    };
    reader.readAsDataURL(file);
  });

  checkBtn.addEventListener('click', () => {
    const message = messageInput.value.trim();
    if (!message) return alert('Enter a message first.');
    fetch('/analyze', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({message})
    })
    .then(res => res.json())
    .then(data => {
      displayResult(data);
    })
    .catch(err => {
      console.error(err);
      alert('Failed to connect to server.');
    });
  });

  function displayResult(data) {
    if (data.error) {
      resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
      return;
    }

    const r = data.detection_result;
    resultDiv.style.backgroundColor = r.is_scam ? '#f8d7da' : '#d4edda';
    resultDiv.style.color = '#000';
    resultDiv.innerHTML = `
      <strong>Extracted Text:</strong><br>${data.extracted_text}<br><br>
      <strong>Scam?</strong> ${r.is_scam ? 'ðŸš¨ YES' : 'âœ… No'}<br>
      <strong>Scam Type:</strong> ${r.scam_type}<br>
      <strong>Red Flags:</strong> ${r.red_flags.join(', ')}
    `;
  }
</script>
</body>
</html>
